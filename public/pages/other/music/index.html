<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PeteZah</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style>
      :root {
        --bg-start: #0a1a2e;
        --bg-end: #1a2a4e;
        --highlight: #fff;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        align-items: center;
        background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
        color: var(--highlight);
        display: flex;
        flex-direction: column;
        font-family:
          Inter,
          -apple-system,
          BlinkMacSystemFont,
          'Segoe UI',
          Roboto,
          sans-serif;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
      }

      .god-rays {
        --stripes: repeating-linear-gradient(
          100deg,
          rgb(20 40 60 / 80%) 0%,
          rgb(20 40 60 / 80%) 7%,
          transparent 10%,
          transparent 12%,
          rgb(20 40 60 / 80%) 16%
        );
        --rays: repeating-linear-gradient(
          100deg,
          rgb(30 50 90 / 90%) 10%,
          rgb(20 40 80 / 90%) 15%,
          rgb(30 50 90 / 90%) 20%,
          rgb(20 40 80 / 90%) 25%,
          rgb(30 50 90 / 90%) 30%
        );

        animation: fadeIn 2s ease;
        background-image: var(--stripes), var(--rays);
        background-position:
          50% 50%,
          50% 50%;
        background-size: 300%, 200%;
        height: 550px;
        left: 0;
        mask-image: radial-gradient(ellipse at 100% 0%, white 40%, transparent 70%);
        mask-image: radial-gradient(ellipse at 100% 0%, rgb(255 255 255 / 0%) 40%, transparent 70%);
        pointer-events: none;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: -1;
      }

      .god-rays::after {
        animation: god-rays 40s linear infinite;
        background-attachment: fixed;
        background-image: var(--stripes), var(--rays);
        background-size: 200%, 100%;
        content: '';
        inset: 0;
        mix-blend-mode: difference;
        position: absolute;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      @keyframes god-rays {
        0% {
          background-position:
            0% 0%,
            0% 0%;
        }

        100% {
          background-position:
            400% 400%,
            400% 400%;
        }
      }

      .search-container {
        border: 1px solid rgb(255 255 255 / 10%);
        border-radius: 12px;
        left: 50%;
        margin-bottom: 20px;
        max-width: 560px;
        position: absolute;
        top: 20px;
        transform: translateX(-50%);
        width: 100%;
        z-index: 100;
      }

      .search-input {
        backdrop-filter: blur(5px);
        background: rgb(255 255 255 / 10%);
        border: none;
        border-radius: 12px;
        color: var(--highlight);
        font-family: Inter, sans-serif;
        font-size: 14px;
        outline: none;
        padding: 12px 20px;
        transition: all 0.2s ease;
        width: 100%;
      }

      .search-input::placeholder {
        color: rgb(255 255 255 / 60%);
      }

      .search-input:focus {
        background: rgb(255 255 255 / 20%);
        box-shadow: 0 0 15px rgb(0 0 0 / 30%);
      }

      .search-results {
        backdrop-filter: blur(10px);
        background: rgb(10 26 46 / 70%);
        border: 1px solid rgb(255 255 255 / 10%);
        border-radius: 8px;
        left: 50%;
        max-height: 400px;
        max-width: 560px;
        opacity: 0;
        overflow-y: auto;
        position: absolute;
        top: 75px;
        transform: translateX(-50%) translateY(-7px);
        transition: all 0.2s ease;
        visibility: hidden;
        width: 100%;
        z-index: 99;
      }

      .search-results.active {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
        visibility: visible;
      }

      .result-item {
        align-items: center;
        cursor: pointer;
        display: flex;
        overflow: hidden;
        padding: 10px 14px;
        transition: background 0.2s;
      }

      .result-item:hover {
        background: rgb(255 255 255 / 10%);
      }

      .result-img {
        border-radius: 6px;
        flex-shrink: 0;
        height: 50px;
        margin-right: 12px;
        overflow: hidden;
        width: 50px;
      }

      .result-img img {
        height: 100%;
        object-fit: cover;
        width: 100%;
      }

      .result-info {
        flex: 1;
      }

      .result-title {
        color: var(--highlight);
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 4px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .result-artist {
        color: var(--highlight);
        font-size: 12px;
        opacity: 0.7;
      }

      .main-container {
        display: flex;
        justify-content: space-between;
        margin-top: 80px;
        max-width: 1200px;
        width: 100%;
      }

      .favorites-column {
        background: rgb(10 26 46 / 80%);
        border: 1px solid rgb(255 255 255 / 10%);
        border-radius: 8px;
        box-shadow: 4px 4px 1px rgb(0 0 0 / 30%);
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-left: 20px;
        max-height: 500px;
        overflow-y: auto;
        padding: 15px;
        width: 35%;
      }

      .favorites-column::-webkit-scrollbar {
        width: 6px;
      }

      .favorites-column::-webkit-scrollbar-track {
        background: rgb(255 255 255 / 5%);
        border-radius: 3px;
      }

      .favorites-column::-webkit-scrollbar-thumb {
        background: rgb(255 255 255 / 30%);
        border-radius: 3px;
      }

      .favorites-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 10px;
        text-align: center;
      }

      .favorite-item {
        align-items: center;
        cursor: pointer;
        display: flex;
        flex-direction: row;
        padding: 10px;
        transition: background 0.2s;
      }

      .favorite-item:hover {
        background: rgb(255 255 255 / 10%);
      }

      .favorite-item .result-img {
        height: 40px;
        margin-right: 10px;
        width: 40px;
      }

      .favorite-item .result-info {
        flex: 1;
      }

      .favorite-item .result-title {
        font-size: 10px;
      }

      .favorite-item .result-artist {
        font-size: 8px;
      }

      .favorite-item .remove-fav {
        font-size: 12px;
        margin-left: 10px;
        opacity: 0.6;
      }

      .favorite-item .remove-fav:hover {
        opacity: 1;
      }

      .favorite-item .skip-prev,
      .favorite-item .skip-next {
        font-size: 12px;
        margin-left: 5px;
        opacity: 0.6;
      }

      .favorite-item .skip-prev:hover,
      .favorite-item .skip-next:hover {
        opacity: 1;
      }

      .play-favorites-btn {
        align-items: center;
        background: rgb(255 255 255 / 15%);
        border-radius: 8px;
        color: var(--highlight);
        cursor: pointer;
        display: flex;
        font-size: 16px;
        gap: 8px;
        justify-content: center;
        padding: 8px;
        text-align: center;
        transition: all 0.2s ease;
      }

      .play-favorites-btn:hover {
        background: rgb(255 255 255 / 25%);
      }

      .play-favorites-btn:active {
        transform: scale(0.95);
      }

      .player {
        align-items: center;
        background: rgb(10 26 46 / 80%);
        border: 1px solid rgb(255 255 255 / 10%);
        border-radius: 12px;
        box-shadow: 4px 4px 1px rgb(0 0 0 / 30%);
        display: flex;
        gap: 20px;
        padding: 25px;
        width: 65%;
      }

      .album-art {
        align-items: center;
        background: rgb(255 255 255 / 10%);
        border-radius: 12px;
        display: flex;
        flex: 0 0 250px;
        height: 250px;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      .album-art i {
        color: rgb(255 255 255 / 50%);
        font-size: 120px;
        position: absolute;
      }

      .album-art img {
        height: 100%;
        object-fit: cover;
        position: relative;
        width: 100%;
        z-index: 1;
      }

      .info {
        display: flex;
        flex: 1;
        flex-direction: column;
        justify-content: center;
        padding-left: 0;
        position: relative;
        text-shadow: none;
      }

      .top-icons {
        position: absolute;
        right: 0;
        top: 0;
      }

      .top-icons i {
        color: var(--highlight);
        cursor: pointer;
        font-size: 18px;
        opacity: 0.6;
      }

      .top-icons i:hover {
        opacity: 1;
      }

      .track-title {
        color: var(--highlight);
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 4px;
        max-width: 350px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .artist {
        color: var(--highlight);
        font-size: 18px;
        margin-bottom: 20px;
        max-width: 350px;
        opacity: 0.75;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .controls {
        align-items: center;
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 18px;
      }

      .control-row {
        display: flex;
        gap: 6px;
      }

      .controls i {
        align-items: center;
        background: rgb(255 255 255 / 15%);
        border-radius: 50%;
        color: var(--highlight);
        cursor: pointer;
        display: flex;
        font-size: 18px;
        height: 38px;
        justify-content: center;
        opacity: 0.8;
        padding: 10px;
        transition: all 0.2s ease;
        width: 38px;
      }

      .controls i:hover {
        background: rgb(255 255 255 / 25%);
        opacity: 1;
      }

      .controls i:active {
        transform: scale(0.95);
      }

      .control-btn {
        cursor: pointer;
      }

      .seekbar {
        background: rgb(255 255 255 / 20%);
        border-radius: 6px;
        cursor: pointer;
        height: 6px;
        position: relative;
        transition: height 0.2s ease;
      }

      .seekbar.active {
        height: 8px;
      }

      #progress {
        background: var(--highlight);
        border-radius: 3px;
        height: 100%;
        width: 0%;
      }

      .timecodes {
        color: var(--highlight);
        display: flex;
        font-size: 10px;
        justify-content: space-between;
        margin-top: 4px;
        opacity: 0.7;
      }

      #ytPlayer {
        height: 1px;
        left: 0;
        opacity: 0.01;
        position: absolute;
        top: 0;
        width: 1px;
      }

      .loading {
        font-size: 12px;
        padding-bottom: 10px;
        padding-top: 0;
        text-align: center;
      }

      .search-results::-webkit-scrollbar {
        width: 6px;
      }

      .search-results::-webkit-scrollbar-track {
        background: rgb(255 255 255 / 5%);
        border-radius: 3px;
      }

      .search-results::-webkit-scrollbar-thumb {
        background: rgb(255 255 255 / 30%);
        border-radius: 3px;
      }

      .lyrics-toggle {
        align-items: center;
        backdrop-filter: blur(5px);
        background: rgb(255 255 255 / 15%);
        border-radius: 10px;
        bottom: 20px;
        box-shadow: 0 4px 8px rgb(0 0 0 / 20%);
        cursor: pointer;
        display: flex;
        height: 40px;
        justify-content: center;
        left: 50%;
        position: fixed;
        transform: translateX(-50%);
        transition: all 0.2s ease;
        width: 40px;
        z-index: 100;
      }

      .lyrics-toggle:hover {
        background: rgb(255 255 255 / 25%);
      }

      .lyrics-toggle i {
        color: var(--highlight);
        font-size: 16px;
      }

      .lyrics-info {
        display: none;
        flex: 1;
        flex-direction: column;
        justify-content: flex-start;
        padding-left: 0;
        text-shadow: 0 0 12px rgb(0 0 0 / 30%);
      }

      .lyrics-content {
        color: var(--highlight);
        font-size: 14px;
        line-height: 1.6;
        max-height: 250px;
        overflow-y: auto;
        padding-right: 10px;
        text-align: left;
        white-space: pre-line;
      }

      .lyrics-content::-webkit-scrollbar {
        width: 4px;
      }

      .lyrics-content::-webkit-scrollbar-track {
        background: rgb(255 255 255 / 5%);
        border-radius: 3px;
      }

      .lyrics-content::-webkit-scrollbar-thumb {
        background: rgb(255 255 255 / 30%);
        border-radius: 3px;
      }

      .lyric-line {
        color: #999;
        filter: blur(2px);
        font-size: 12px;
        line-height: 1.6;
        margin: 3px 0;
        opacity: 0.4;
        padding: 3px 0;
        transition: all 0.2s ease;
      }

      .lyric-line.active {
        color: var(--highlight);
        filter: blur(0);
        font-size: 14px;
        font-weight: bold;
        opacity: 1;
      }

      .lyric-line.next {
        color: #ccc;
        filter: blur(0.6px);
        opacity: 0.7;
      }

      .lyric-line.prev {
        color: #bbb;
        filter: blur(1px);
        opacity: 0.55;
      }

      .error-message {
        color: #ff4d4d;
        font-size: 12px;
        margin-top: 10px;
        text-align: center;
      }
    </style>
  </head>

  <body>
    <div class="god-rays"></div>
    <div class="search-container">
      <input type="text" class="search-input" placeholder="Search for any song..." id="searchInput" />
    </div>
    <div class="search-results" id="searchResults"></div>
    <div class="main-container">
      <div class="player">
        <div class="album-art">
          <i class="fa-solid fa-music" id="musicIcon"></i>
          <img src="" alt="Album" id="albumCover" crossorigin="anonymous" style="display: none" />
        </div>
        <div class="info" id="playerInfo">
          <div class="top-icons">
            <i id="favoritesBtn" class="fa-solid fa-star"></i>
          </div>
          <div class="track-title" id="trackTitle">Not Playing</div>
          <div class="artist" id="artistName"></div>
          <div class="controls">
            <div class="control-row">
              <i id="backward10" class="fas fa-backward control-btn"></i>
              <i id="backward5" class="fa-solid fa-chevron-left control-btn"></i>
              <i id="playPause" class="fa-solid fa-play control-btn"></i>
              <i id="forward5" class="fa-solid fa-chevron-right control-btn"></i>
              <i id="forward10" class="fas fa-forward control-btn"></i>
            </div>
            <div class="control-row">
              <i id="loopToggle" class="fa-solid fa-repeat control-btn"></i>
              <i id="volumeBtn" class="fa-solid fa-volume-high control-btn"></i>
              <i id="favoriteBtn" class="fa-regular fa-heart control-btn"></i>
            </div>
          </div>
          <div id="seekbar" class="seekbar">
            <div id="progress"></div>
          </div>
          <div class="timecodes">
            <span id="currentTime">0:00</span>
            <span id="remainingTime">-0:00</span>
          </div>
        </div>
        <div class="lyrics-info" id="lyricsInfo">
          <div class="lyrics-content" id="lyricsContent"></div>
        </div>
      </div>
      <div class="favorites-column" id="favoritesColumn">
        <div class="favorites-title">Favorites</div>
        <div class="play-favorites-btn" id="playFavoritesBtn"><i class="fas fa-play"></i> Play Favorites</div>
      </div>
      <div class="lyrics-toggle" id="lyricsToggle">
        <i class="fa-solid fa-align-left"></i>
      </div>
      <div id="player-container">
        <div id="ytPlayer"></div>
      </div>
      <script>
        const YT_KEY = 'AIzaSyBHsreHN12KYibi3kF1hWFI6T7-jJ_VlSo';
        const SEARCH_EP = 'https://itunes.apple.com/search?term=';
        const searchInput = document.querySelector('#searchInput');
        const searchResults = document.querySelector('#searchResults');
        const trackTitle = document.querySelector('#trackTitle');
        const artistName = document.querySelector('#artistName');
        const albumCover = document.querySelector('#albumCover');
        const musicIcon = document.querySelector('#musicIcon');
        const playPauseBtn = document.querySelector('#playPause');
        const volumeBtn = document.querySelector('#volumeBtn');
        const seekBar = document.querySelector('#seekbar');
        const progressBar = document.querySelector('#progress');
        const currentTimeSpan = document.querySelector('#currentTime');
        const remainingTimeSpan = document.querySelector('#remainingTime');
        const lyricsToggle = document.querySelector('#lyricsToggle');
        const playerInfo = document.querySelector('#playerInfo');
        const lyricsInfo = document.querySelector('#lyricsInfo');
        const lyricsContent = document.querySelector('#lyricsContent');
        const favoriteBtn = document.querySelector('#favoriteBtn');
        const favoritesBtn = document.querySelector('#favoritesBtn');
        const favoritesColumn = document.querySelector('#favoritesColumn');
        const playFavoritesBtn = document.querySelector('#playFavoritesBtn');
        let showingLyrics = false;
        let isMuted = false;
        let player = null;
        let isPlaying = false;
        let isDragging = false;
        let searchTimeout;
        let playerReady = false;
        let currentTrack = {
          title: 'Not Playing',
          artist: '',
          artwork: '',
          genre: ''
        };
        let isFavorite = false;
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let currentFavoriteIndex = -1;
        async function loadYouTubeAPI(retries = 3, delay = 2000) {
          return new Promise((resolve, reject) => {
            if (window.YT && window.YT.Player) {
              resolve();
              return;
            }
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            tag.onerror = () => {
              if (retries > 0) {
                setTimeout(() => loadYouTubeAPI(retries - 1, delay), delay);
              } else {
                reject(new Error('Failed to load YouTube API'));
              }
            };
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            window.onYouTubeIframeAPIReady = () => resolve();
          });
        }
        async function initPlayer() {
          try {
            await loadYouTubeAPI();
            player = new window.YT.Player('ytPlayer', {
              height: '1',
              width: '1',
              videoId: '',
              host: 'https://www.youtube-nocookie.com',
              playerVars: {
                playsinline: 1,
                enablejsapi: 1,
                modestbranding: 1,
                rel: 0,
                showinfo: 0,
                autoplay: 0
              },
              events: {
                onReady: () => {
                  playerReady = true;
                  playPauseBtn.addEventListener('click', togglePlayback);
                  volumeBtn.addEventListener('click', toggleMute);
                  seekBar.addEventListener('mousedown', startSeek);
                  document.addEventListener('mousemove', dragSeek);
                  document.addEventListener('mouseup', endSeek);
                  setInterval(updateProgress, 500);
                  if (favorites.length > 0) {
                    const lastPlayed = JSON.parse(localStorage.getItem('lastPlayed'));
                    if (lastPlayed) {
                      playSong(lastPlayed.title, lastPlayed.artist, lastPlayed.artwork, lastPlayed.genre);
                    }
                  }
                },
                onStateChange: (event) => {
                  if (event.data === window.YT.PlayerState.PLAYING) {
                    isPlaying = true;
                    playPauseBtn.classList.remove('fa-play');
                    playPauseBtn.classList.add('fa-pause');
                  } else if (event.data === window.YT.PlayerState.PAUSED || event.data === window.YT.PlayerState.ENDED) {
                    isPlaying = false;
                    playPauseBtn.classList.remove('fa-pause');
                    playPauseBtn.classList.add('fa-play');
                  }
                  if (event.data === window.YT.PlayerState.ENDED && isLooping) {
                    player.seekTo(0);
                    player.playVideo();
                  } else if (event.data === window.YT.PlayerState.ENDED && currentFavoriteIndex >= 0 && currentFavoriteIndex < favorites.length - 1) {
                    playNextFavorite();
                  }
                },
                onError: (event) => {
                  searchResults.innerHTML = '<div class="error-message">Failed to load video. Please try another song.</div>';
                }
              }
            });
          } catch (error) {
            searchResults.innerHTML = '<div class="error-message">Unable to initialize player. Please refresh the page.</div>';
          }
        }
        function toggleMute() {
          if (!player || !playerReady) return;
          if (isMuted) {
            player.unMute();
            volumeBtn.className = 'fa-solid fa-volume-high control-btn';
            isMuted = false;
          } else {
            player.mute();
            volumeBtn.className = 'fa-solid fa-volume-xmark control-btn';
            isMuted = true;
          }
        }
        searchInput.addEventListener('input', function () {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            const query = searchInput.value.trim();
            if (query.length > 1) {
              searchSongs(query);
            } else {
              hideSearchResults();
            }
          }, 500);
        });
        searchInput.addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            clearTimeout(searchTimeout);
            const query = searchInput.value.trim();
            if (query.length > 1) {
              searchSongs(query);
            }
          }
        });
        async function searchSongs(query) {
          searchResults.innerHTML = '<div class="loading">Searching...</div>';
          showSearchResults();
          const url = `${SEARCH_EP}${encodeURIComponent(query)}&media=music&limit=10`;
          try {
            const response = await fetch(url);
            const data = await response.json();
            displaySearchResults(data.results);
          } catch (error) {
            searchResults.innerHTML = '<div class="error-message">Search failed. Please try again.</div>';
          }
        }
        function displaySearchResults(results) {
          if (!results || results.length === 0) {
            searchResults.innerHTML = '<div class="loading">No results found</div>';
            return;
          }
          searchResults.innerHTML = '';
          results.forEach((item) => {
            if (!item.trackName || !item.artistName) return;
            const resultElement = document.createElement('div');
            resultElement.className = 'result-item';
            resultElement.innerHTML = `
<div class="result-img">
<img src="${item.artworkUrl100}" alt="${item.trackName}" crossorigin="anonymous">
</div>
<div class="result-info">
<div class="result-title">${item.trackName}</div>
<div class="result-artist">${item.artistName}</div>
</div>
`;
            resultElement.addEventListener('click', () => {
              playSong(item.trackName, item.artistName, item.artworkUrl100, item.primaryGenreName);
              hideSearchResults();
              searchInput.value = '';
              currentFavoriteIndex = -1;
            });
            searchResults.appendChild(resultElement);
          });
        }
        function showSearchResults() {
          searchResults.classList.add('active');
        }
        function hideSearchResults() {
          searchResults.classList.remove('active');
        }
        function playSong(title, artist, artwork, genre = '') {
          trackTitle.textContent = title;
          artistName.textContent = artist;
          albumCover.src = artwork.replace('100x100', '600x600');
          albumCover.style.display = 'block';
          musicIcon.style.display = 'none';
          if (showingLyrics) {
            fetchLyrics(artist, title);
          }
          currentTrack = { title, artist, artwork, genre };
          localStorage.setItem('lastPlayed', JSON.stringify(currentTrack));
          isFavorite = favorites.some((fav) => fav.title === title && fav.artist === artist);
          favoriteBtn.className = isFavorite ? 'fa-solid fa-heart control-btn' : 'fa-regular fa-heart control-btn';
          const searchQuery = `${title} ${artist}`;
          getYT(searchQuery);
        }
        function getYT(query) {
          const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&key=${YT_KEY}&type=video&maxResults=1`;
          fetch(url)
            .then((response) => response.json())
            .then((data) => {
              if (data.items && data.items.length > 0) {
                const videoId = data.items[0].id.videoId;
                loadVid(videoId);
              } else {
                searchResults.innerHTML = '<div class="error-message">No YouTube results found</div>';
              }
            })
            .catch((error) => {
              searchResults.innerHTML = '<div class="error-message">Failed to search YouTube. Please try again.</div>';
            });
        }
        function loadVid(videoId) {
          if (player && playerReady && player.loadVideoById) {
            player.loadVideoById(videoId);
            setTimeout(() => {
              if (!isMuted) player.unMute();
              player.playVideo();
            }, 100);
          } else {
            initPlayer().then(() => {
              if (player && playerReady && player.loadVideoById) {
                player.loadVideoById(videoId);
                setTimeout(() => {
                  if (!isMuted) player.unMute();
                  player.playVideo();
                }, 100);
              } else {
                searchResults.innerHTML = '<div class="error-message">Unable to initialize player. Please refresh the page.</div>';
              }
            });
          }
        }
        lyricsToggle.addEventListener('click', function () {
          showingLyrics = !showingLyrics;
          if (showingLyrics) {
            playerInfo.style.display = 'none';
            albumCover.style.display = 'none';
            musicIcon.style.display = 'none';
            lyricsInfo.style.display = 'flex';
            fetchLyrics(currentTrack.artist, currentTrack.title);
            lyricsToggle.innerHTML = '<i class="fa-solid fa-align-left"></i>';
          } else {
            playerInfo.style.display = 'flex';
            albumCover.style.display = currentTrack.title === 'Not Playing' ? 'none' : 'block';
            musicIcon.style.display = currentTrack.title === 'Not Playing' ? 'block' : 'none';
            lyricsInfo.style.display = 'none';
            lyricsToggle.innerHTML = '<i class="fa-solid fa-align-left"></i>';
          }
        });
        async function fetchLyrics(artist, title) {
          lyricsContent.textContent = 'Loading lyrics...';
          const cleanArtist = encodeURIComponent(artist.trim());
          const cleanTitle = encodeURIComponent(title.trim());
          try {
            const response = await fetch(`https://lrclib.net/api/get?artist_name=${cleanArtist}&track_name=${cleanTitle}`);
            if (!response.ok) throw new Error('Lyrics not found');
            const data = await response.json();
            if (data.syncedLyrics) {
              const lines = data.syncedLyrics
                .trim()
                .split('\n')
                .map((line) => {
                  const match = line.match(/^\[(\d+):(\d+\.\d+)](.*)$/);
                  if (match) {
                    const time = parseInt(match[1], 10) * 60 + parseFloat(match[2]);
                    const text = match[3].trim();
                    return { time, text };
                  }
                  return null;
                })
                .filter(Boolean);
              lyricsContent.innerHTML = lines
                .map((line, index) => `<div class="lyric-line" data-time="${line.time}" id="lyric-${index}">${line.text}</div>`)
                .join('');
              if (window.lyricsSyncInterval) clearInterval(window.lyricsSyncInterval);
              window.lyricsSyncInterval = setInterval(() => {
                const currentTime = player && playerReady && player.getCurrentTime ? player.getCurrentTime() : 0;
                let activeIndex = -1;
                for (let i = 0; i < lines.length; i++) {
                  if (currentTime >= lines[i].time) {
                    activeIndex = i;
                  } else {
                    break;
                  }
                }
                document.querySelectorAll('.lyric-line').forEach((el, i) => {
                  el.classList.remove('active', 'prev', 'next');
                  if (i === activeIndex) {
                    el.classList.add('active');
                    lyricsContent.scrollTo({
                      top: el.offsetTop - lyricsContent.clientHeight / 2 + el.clientHeight / 2,
                      behavior: 'smooth'
                    });
                  } else if (i === activeIndex - 1) {
                    el.classList.add('prev');
                  } else if (i === activeIndex + 1) {
                    el.classList.add('next');
                  }
                });
              }, 300);
            } else if (data.lyrics) {
              const formattedLyrics = data.lyrics.replace(/\n/g, '<br>');
              lyricsContent.innerHTML = formattedLyrics;
            } else {
              lyricsContent.textContent = 'No lyrics available.';
            }
          } catch (error) {
            lyricsContent.textContent = 'No lyrics available.';
          }
        }
        function togglePlayback() {
          if (!player || !playerReady) return;
          if (isPlaying) {
            player.pauseVideo();
          } else {
            player.playVideo();
          }
        }
        function startSeek(e) {
          if (!player || !playerReady) return;
          isDragging = true;
          seekBar.classList.add('active');
          updateSeekPosition(e);
        }
        function dragSeek(e) {
          if (isDragging) updateSeekPosition(e);
        }
        function endSeek() {
          if (isDragging) {
            isDragging = false;
            seekBar.classList.remove('active');
          }
        }
        function updateSeekPosition(e) {
          if (!player || !playerReady || !player.getDuration) return;
          const rect = seekBar.getBoundingClientRect();
          const position = (e.clientX - rect.left) / rect.width;
          const percent = Math.min(Math.max(position, 0), 1);
          progressBar.style.width = percent * 100 + '%';
          const duration = player.getDuration();
          player.seekTo(percent * duration, true);
        }
        function updateProgress() {
          if (!player || !playerReady || !player.getDuration || isDragging) return;
          try {
            const duration = player.getDuration() || 0;
            const currentTime = player.getCurrentTime() || 0;
            const percent = (currentTime / duration) * 100;
            progressBar.style.width = percent + '%';
            currentTimeSpan.textContent = formatTime(currentTime);
            remainingTimeSpan.textContent = '-' + formatTime(duration - currentTime);
          } catch (error) {}
        }
        function formatTime(seconds) {
          const minutes = Math.floor(seconds / 60);
          const secs = Math.floor(seconds % 60)
            .toString()
            .padStart(2, '0');
          return `${minutes}:${secs}`;
        }
        document.addEventListener('click', function (e) {
          if (!searchResults.contains(e.target) && e.target !== searchInput) {
            hideSearchResults();
            favoritesColumn.classList.remove('active');
          }
        });
        function minustenseconds() {
          if (!player || !playerReady || !player.getCurrentTime || !player.getDuration) return;
          const currentTime = player.getCurrentTime();
          const newTime = Math.max(0, currentTime - 10);
          player.seekTo(newTime, true);
        }
        function minusfiveseconds() {
          if (!player || !playerReady || !player.getCurrentTime || !player.getDuration) return;
          const currentTime = player.getCurrentTime();
          const newTime = Math.max(0, currentTime - 5);
          player.seekTo(newTime, true);
        }
        function plusfiveseconds() {
          if (!player || !playerReady || !player.getCurrentTime || !player.getDuration) return;
          const currentTime = player.getCurrentTime();
          const duration = player.getDuration();
          const newTime = Math.min(currentTime + 5, duration);
          player.seekTo(newTime, true);
        }
        function plustenseconds() {
          if (!player || !playerReady || !player.getCurrentTime || !player.getDuration) return;
          const currentTime = player.getCurrentTime();
          const duration = player.getDuration();
          const newTime = Math.min(currentTime + 10, duration);
          player.seekTo(newTime, true);
        }
        favoriteBtn.addEventListener('click', () => {
          if (favorites.length >= 10) {
            alert('Maximum 10 favorites allowed!');
            return;
          }
          const track = {
            title: currentTrack.title,
            artist: currentTrack.artist,
            artwork: currentTrack.artwork,
            genre: currentTrack.genre
          };
          if (isFavorite) {
            favorites = favorites.filter((fav) => fav.title !== track.title || fav.artist !== track.artist);
          } else {
            favorites.push(track);
          }
          localStorage.setItem('favorites', JSON.stringify(favorites));
          isFavorite = !isFavorite;
          favoriteBtn.className = isFavorite ? 'fa-solid fa-heart control-btn' : 'fa-regular fa-heart control-btn';
          updateFavorites();
        });
        favoritesBtn.addEventListener('click', () => {
          favoritesColumn.classList.toggle('active');
          updateFavorites();
        });
        function updateFavorites() {
          favoritesColumn.innerHTML = `
<div class="favorites-title">Favorites</div>
<div class="play-favorites-btn" id="playFavoritesBtn"><i class="fas fa-play"></i> Play Favorites</div>
${favorites
  .map(
    (fav) => `
<div class="favorite-item" onclick="playSong('${fav.title}', '${fav.artist}', '${fav.artwork}', '${fav.genre}');currentFavoriteIndex=${favorites.findIndex((f) => f.title === '${fav.title}' && f.artist === '${fav.artist}')}">
<div class="result-img"><img src="${fav.artwork.replace('100x100', '600x600')}" alt="${fav.title}"></div>
<div class="result-info">
<div class="result-title">${fav.title}</div>
<div class="result-artist">${fav.artist}</div>
</div>
<i class="fa-solid fa-times remove-fav" onclick="event.stopPropagation();removeFavorite('${fav.title}', '${fav.artist}')"></i>
<i class="fa-solid fa-step-backward skip-prev" onclick="event.stopPropagation();skipFavoritePrev('${fav.title}', '${fav.artist}')"></i>
<i class="fa-solid fa-step-forward skip-next" onclick="event.stopPropagation();skipFavoriteNext('${fav.title}', '${fav.artist}')"></i>
</div>
`
  )
  .join('')}
`;
          const newPlayFavoritesBtn = document.querySelector('#playFavoritesBtn');
          if (newPlayFavoritesBtn) {
            newPlayFavoritesBtn.addEventListener('click', playFavorites);
          }
        }
        function removeFavorite(title, artist) {
          favorites = favorites.filter((fav) => fav.title !== title || fav.artist !== artist);
          localStorage.setItem('favorites', JSON.stringify(favorites));
          if (currentFavoriteIndex >= favorites.length) {
            currentFavoriteIndex = -1;
          }
          updateFavorites();
        }
        function skipFavoritePrev(title, artist) {
          const index = favorites.findIndex((fav) => fav.title === title && fav.artist === artist);
          if (index > 0) {
            currentFavoriteIndex = index - 1;
            playSong(
              favorites[currentFavoriteIndex].title,
              favorites[currentFavoriteIndex].artist,
              favorites[currentFavoriteIndex].artwork,
              favorites[currentFavoriteIndex].genre
            );
          } else {
            currentFavoriteIndex = favorites.length - 1;
            playSong(
              favorites[currentFavoriteIndex].title,
              favorites[currentFavoriteIndex].artist,
              favorites[currentFavoriteIndex].artwork,
              favorites[currentFavoriteIndex].genre
            );
          }
        }
        function skipFavoriteNext(title, artist) {
          const index = favorites.findIndex((fav) => fav.title === title && fav.artist === artist);
          if (index < favorites.length - 1) {
            currentFavoriteIndex = index + 1;
            playSong(
              favorites[currentFavoriteIndex].title,
              favorites[currentFavoriteIndex].artist,
              favorites[currentFavoriteIndex].artwork,
              favorites[currentFavoriteIndex].genre
            );
          } else {
            currentFavoriteIndex = 0;
            playSong(
              favorites[currentFavoriteIndex].title,
              favorites[currentFavoriteIndex].artist,
              favorites[currentFavoriteIndex].artwork,
              favorites[currentFavoriteIndex].genre
            );
          }
        }
        function playFavorites() {
          if (favorites.length === 0) return;
          currentFavoriteIndex = 0;
          playSong(favorites[0].title, favorites[0].artist, favorites[0].artwork, favorites[0].genre);
        }
        function playNextFavorite() {
          if (currentFavoriteIndex < favorites.length - 1) {
            currentFavoriteIndex++;
            playSong(
              favorites[currentFavoriteIndex].title,
              favorites[currentFavoriteIndex].artist,
              favorites[currentFavoriteIndex].artwork,
              favorites[currentFavoriteIndex].genre
            );
          } else {
            currentFavoriteIndex = 0;
            playSong(favorites[0].title, favorites[0].artist, favorites[0].artwork, favorites[0].genre);
          }
        }
        window.addEventListener('DOMContentLoaded', () => {
          document.querySelector('#backward10')?.addEventListener('click', minustenseconds);
          document.querySelector('#backward5')?.addEventListener('click', minusfiveseconds);
          document.querySelector('#forward5')?.addEventListener('click', plusfiveseconds);
          document.querySelector('#forward10')?.addEventListener('click', plustenseconds);
          const loopToggle = document.querySelector('#loopToggle');
          let isLooping = false;
          loopToggle.addEventListener('click', () => {
            isLooping = !isLooping;
            loopToggle.className = isLooping ? 'fa-solid fa-repeat-1 control-btn' : 'fa-solid fa-repeat control-btn';
          });
          updateFavorites();
          initPlayer();
        });
      </script>
      <script src="/storage/js/settings.js"></script>
    </div>
  </body>
</html>
